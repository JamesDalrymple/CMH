{
    "collab_server" : "",
    "contents" : "# filtering by fund\nall_funds <- services[, unique(fund)]\n\n#### create fund xlsx files ####\nfor(i in seq_along(all_funds)) {\n  keep_funds <- all_funds[i]\n  tmp_services <- services[fund %in% keep_funds]\n  tmp_mi_services <- mi_services[fund %in% keep_funds]\n  tmp_yf_services <- yf_services[fund %in% keep_funds]\n\n  #### create workbook ####\n  wb <- createWorkbook()\n  # bold option and underline\n  cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()\n  ### create DD ###\n  dd_sheet <- createSheet(wb, sheetName=\"DD\")\n  dd_services <- copy(tmp_services[team==\"DD\"])\n  addDataFrame(x=dd_services, sheet=dd_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### Youth and Family ###\n  yf_sheet <- createSheet(wb, sheetName=\"Y&F\")\n  addDataFrame(x=tmp_yf_services, sheet=yf_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### MI Adult ###\n  mi_sheet <- createSheet(wb, sheetName=\"MI\")\n  addDataFrame(x=tmp_mi_services, sheet=mi_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### level 0 - no TCM ###\n  l0_sheet <- createSheet(wb, sheetName=\"MI_L0\")\n  l0_noTCM <- copy(tmp_mi_services[level==\"L0_No_TCM\"])\n  addDataFrame(x=l0_noTCM, sheet=l0_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### level 1 ###\n  l1_sheet <- createSheet(wb, sheetName=\"MI_L1\")\n  l1_mi <- copy(tmp_mi_services[level==\"L1\"])\n  addDataFrame(x=l1_mi, sheet=l1_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### level 2 ###\n  l2_sheet <- createSheet(wb, sheetName=\"MI_L2\")\n  l2_mi <- copy(tmp_mi_services[level==\"L2\"])\n  addDataFrame(x=l2_mi, sheet=l2_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### level 3 ###\n  l3_sheet <- createSheet(wb, sheetName=\"MI_L3\")\n  l3_mi = copy(tmp_mi_services[level==\"L3\"])\n  addDataFrame(x=l3_mi, sheet=l3_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### ACT ###\n  act_sheet <- createSheet(wb, sheetName=\"MI_L4_ACT\")\n  act_services <- copy(tmp_mi_services[team==\"ACT\"])\n  addDataFrame(x=act_services, sheet=act_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### MI Residential ###\n  res_sheet <- createSheet(wb, sheetName=\"MI_L5_Res\")\n  res_services <- copy(tmp_mi_services[level==\"Residential\"])\n  addDataFrame(x=res_services, sheet=res_sheet, showNA=FALSE,\n               row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### CLS H2015 (CLS | Community) ###\n  cls_h2015_sheet <- createSheet(wb, sheetName=\"CLS H2015\")\n  # filter out cls community blanks\n  cls_h2015_save <- copy(tmp_services)\n  if(length(grep(x=colnames(cls_h2015_save), pattern=\"CLS | Community\", fixed=TRUE))==1) {\n    setnames(cls_h2015_save, \"CLS | Community\", \"cls_community\")\n    cls_h2015_save <- cls_h2015_save[!is.na(cls_community)]\n    setnames(cls_h2015_save, \"cls_community\", \"CLS | Community\")\n    addDataFrame(x=cls_h2015_save, sheet=cls_h2015_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  } else {\n    addDataFrame(x=services[case_no==-1], sheet=cls_h2015_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  }\n  ### CLS H2016 ###\n  cls_h2016_sheet <- createSheet(wb, sheetName=\"CLS H2016\")\n  # filter out cls h2016\n  cls_h2016_save <- copy(tmp_services)\n  if(length(grep(x=colnames(cls_h2016_save),\n                 pattern= \"CLS | Specialized Residential\", fixed=TRUE))>0) {\n    setnames(cls_h2016_save, \"CLS | Specialized Residential\", \"cls_h2016\")\n    cls_h2016_save <- cls_h2016_save[!is.na(cls_h2016)]\n    setnames(cls_h2016_save, \"cls_h2016\", \"CLS | Specialized Residential\")\n    addDataFrame(x=cls_h2016_save, sheet=cls_h2016_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  } else {\n    addDataFrame(x=services[case_no==-1], sheet=cls_h2016_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  }\n  ### CLS T2038 ###\n  cls_t2038_sheet <- createSheet(wb, sheetName=\"CLS T2038\")\n  # filter out cls t2038\n  cls_t2038_save <- copy(tmp_services)\n\n  if(length(grep(x=colnames(cls_t2038_save),\n                 pattern=\"Home Modification | Children/Housing Assistance\", fixed=TRUE))>0) {\n    setnames(cls_t2038_save, \"Home Modification | Children/Housing Assistance\", \"cls_t2038\")\n    cls_t2038_save <- cls_t2038_save[!is.na(cls_t2038)]\n    setnames(cls_t2038_save, \"cls_t2038\", \"Home Modification | Children/Housing Assistance\")\n    # add cls_t2038_save to cls_t2038_sheet\n    addDataFrame(x=cls_t2038_save, sheet=cls_t2038_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  } else {\n    addDataFrame(x=services[case_no==-1], sheet=cls_t2038_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  }\n  ### CLS H0043 (CLS | independent living) ###\n  cls_h0043_sheet <- createSheet(wb, sheetName=\"CLS H0043\")\n  # filter out cls independent living\n  cls_h0043_save <- copy(tmp_services)\n  if(length(grep(x=colnames(cls_h0043_save),\n                 pattern=\"CLS | independent living\", fixed=TRUE))>0) {\n    setnames(cls_h0043_save, \"CLS | independent living\", \"cls_ind_living\")\n    cls_h0043_save <- cls_h0043_save[!is.na(cls_ind_living)]\n    setnames(cls_h0043_save, \"cls_ind_living\", \"CLS | independent living\")\n    addDataFrame(x=cls_h0043_save, sheet=cls_h0043_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  } else {\n    addDataFrame(x=services[case_no==-1], sheet=cls_h0043_sheet, showNA=FALSE,\n                 row.names = FALSE, startRow=1, startColumn=1, colnamesStyle=cs3)\n  }\n  ### create all_fund_sheet ###\n  all_fund_sheet <- createSheet(wb,\n                                sheetName=gsub(x=paste(keep_funds, collapse=\"\"), pattern=\"/\", replace=\"_\") )\n  addDataFrame(x=tmp_services, sheet=all_fund_sheet, showNA=FALSE, row.names=FALSE,\n               startRow=1, startColumn=1, colnamesStyle=cs3)\n  ### create HAB_sheet ###\n  if(nrow(tmp_services[fund==\"HAB spend-down\"])>0 ) {\n    hab_sheet <- createSheet(wb, sheetName=\"HAB spenddown\")\n    addDataFrame(x=tmp_services[fund==\"HAB spend-down\"], sheet=hab_sheet, showNA=FALSE, row.names=FALSE,\n                 startRow=1, startColumn=1, colnamesStyle=cs3)\n  }\n  ### create sheet data information ###\n  sheet_info = createSheet(wb, sheetName=\"Data Info\")\n  addDataFrame(x=aboutFile, sheet=sheet_info, showNA=FALSE,\n               row.names=FALSE, col.names=TRUE, startRow=1,\n               startColumn = 1, colnamesStyle=cs3)\n\n  ### save workbook ###\n  # create result folder\n  ### R 3.2.0 approach\n  if(!dir.exists(file.path(baseWD, resultsWD))) {\n    dir.create(file.path(baseWD, resultsWD))\n    paste(\"folder created\", file.path(baseWD, resultsWD), sep=\"...\")\n  }\n\n  # file name\n  export_file <- paste0(\n    fund_name(keep_funds),\n    \"_service_array_\", run_par, \".xlsx\")\n\n  gc(reset = TRUE)\n  saveWorkbook(wb=wb, file=file.path(baseWD, resultsWD,\n                                     export_file))\n  print(paste(keep_funds, \"completed\"))\n  rm(wb)\n}\n",
    "created" : 1445270616128.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2551754790",
    "id" : "EFD58735",
    "lastKnownWriteTime" : 1444854706,
    "path" : "~/GitHub/CMH/UM/Fund/Code/3_export_xlxs.R",
    "project_path" : "Code/3_export_xlxs.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}